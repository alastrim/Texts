\usepackage{xfp}
\usepackage[utf8]{inputenc}
\usepackage[english,ngerman,main=russian]{babel}
\usepackage{forloop}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric}
\usepackage{boolexpr}

\newcommand{\statstar}
{%
	\tikzstyle{scorestars}=[star, star points=5, star point ratio=2.25, draw,inner sep=0.333ex,anchor=outer point 3]%
	\begin{tikzpicture}[baseline]%
		\draw (0,0) node[name=star,scorestars,fill=black]  {};%
	\end{tikzpicture}%
}

\newcounter{statcirclecounter}
\newcommand{\stat}[1]
{%
	\ifboolexpr{#1 > 8}%
	{%
		\forloop{statcirclecounter}{0}{\value{statcirclecounter} < 8}%
		{%
			\ifboolexpr{(\inteval{#1 / 5}) > \value{statcirclecounter}}%
			{%
				& \statstar%
			}%
			{%
				\ifboolexpr{\value{statcirclecounter} < 5}
				{%
					& \tikz\draw (0,0) circle (1ex);%
				}%
				{%
					& \tikz\draw (0,0) circle (0ex);%
				}%
			}%
		}%
	}%
	{%
		\forloop{statcirclecounter}{0}{\value{statcirclecounter} < 8}%
		{%
			\ifboolexpr{#1 > \value{statcirclecounter}}%
			{%
				& \tikz\draw[black, fill=black] (0,0) circle (1ex);%
			}%
			{%
				\ifboolexpr{\value{statcirclecounter} < 5}
				{%
					& \tikz\draw (0,0) circle (1ex);%
				}%
				{%
					& \tikz\draw (0,0) circle (0ex);%
				}%
			}%
		}%
	}%
}

\newtcolorbox{monsterbox}[2][]{
	enhanced,
	frame hidden,
	before skip=7pt plus2pt,
	boxrule=0pt,
	breakable,
	boxsep=0.25ex,
	toptitle=3mm,
	left=2.5mm,
	right=2.15mm,
	arc=0mm,
	borderline north={4pt}{0pt}{titlered},
	borderline north={2.5pt}{0.75pt}{puregold},
	borderline south={4pt}{0pt}{titlered},
	borderline south={2.5pt}{0.75pt}{puregold},
	colback=monstertan,
	colbacktitle=monstertan,
	colframe=titlered,
	fonttitle=\scshape\bfseries\color{titlered}\Large,
	fontupper=\fontfamily{lmss}\selectfont,
	title=#2,
	after={\vspace{7pt plus 1pt}\noindent},
	#1
}

\newcommand{\monstersection}[1]{
	{\par
	\color{titlered}\normalfont\scshape\Large #1 \vspace{3pt}
	\titleline{\color{titlered}\titlerule[0.6pt]}
	\par\medskip}
	}

\newenvironment{monsteraction}[1][\unskip]{\emph{\textbf{#1.}}}{\vspace{0.5em}}

\newkeycommand\basics[armorclass=0, hitpoints=0, speed=0]{%
	\color{titlered}
	\textbf{Armor Class} \commandkey{armorclass}\\
	\textbf{Hit Points} \commandkey{hitpoints}\\
	\textbf{Speed} \commandkey{speed}\\
}

\newkeycommand\stats[STR=\stat{0}, DEX=\stat{0}, CON=\stat{0}, INT=\stat{0}, WIT=\stat{0}, WIL=\stat{0}]{%\color{titlered}
	\color{titlered}
	\begin{tabular}{lr}
		\begin{tabular}{c}
			\begin{tabular}{lrrrrrrrr}
				\textbf{Сила} \commandkey{STR} \\
				\textbf{Ловкость} \commandkey{DEX} \\
				\textbf{Выносливость} \commandkey{CON}
			\end{tabular}
		\end{tabular}
		
		\begin{tabular}{c}
			\begin{tabular}{lrrrrrrrr}
				\textbf{Интеллект} \commandkey{INT} \\
				\textbf{Смекалка} \commandkey{WIT} \\
				\textbf{Воля} \commandkey{WIL}
			\end{tabular}
		\end{tabular}
	\end{tabular}
}

\newkeycommand\details[skills=,
                      damageimmunities=,
                      savingthrows=,
                      conditionimmunities=,
                      damageresistances=,
                      damagevulnerabilities=,
                      senses=-,
                      languages=-,
                      challenge=0]{%
  \ifcommandkey{savingthrows}
    {\textbf{Saving Throws} \commandkey{savingthrows}\\}{}
  \ifcommandkey{skills}
    {\textbf{Skills} \commandkey{skills}\\}{}
  \ifcommandkey{damagevulnerabilities}
    {\textbf{Damage Vulnerabilities} \commandkey{damagevulnerabilities}\\}{}
  \ifcommandkey{damageresistances}
    {\textbf{Damage Resistances} \commandkey{damageresistances}\\}{}
  \ifcommandkey{damageimmunities}
    {\textbf{Damage Immunities} \commandkey{damageimmunities}\\}{}
  \ifcommandkey{conditionimmunities}
    {\textbf{Condition Immunities} \commandkey{conditionimmunities}\\}{}
  {\textbf{Senses} \commandkey{senses}\\}
  {\textbf{Languages} \commandkey{languages}\\}
  {\textbf{Challenge} \commandkey{challenge}\\}
\color{black}
}
